// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Users {
  id                String   @id @default(uuid()) // Ø´Ù†Ø§Ø³Ù‡ ÛŒÚ©ØªØ§
  fullname          String?
  email             String   @unique // Ø§ÛŒÙ…ÛŒÙ„ (ÛŒÙˆÙ†ÛŒÚ©)
  phone             String?  @unique // Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ (Ø§Ø®ØªÛŒØ§Ø±ÛŒØŒ ÛŒÙˆÙ†ÛŒÚ©)
  password          String // Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± (Ù‡Ø´â€ŒØ´Ø¯Ù‡)
  role              Role     @default(CUSTOMER) //Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø±
  isActive          Boolean  @default(true) //ÙØ¹Ø§Ù„ ÛŒØ§ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±
  preferredLanguage String?  @default("en") // ÛŒØ§ zh
  createdAt         DateTime @default(now()) // ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯ Ø­Ø³Ø§Ø¨
  updatedAt         DateTime @updatedAt // ØªØ§Ø±ÛŒØ® Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ

  profile       UserProfile?
  bankAccounts  BankAccount[]
  UserActionLog UserActionLog[]
  ExchangeOrder ExchangeOrder[]
  resetTokens   PasswordResetOTP[]
}

enum Role {
  ADMIN
  OPERATOR
  CUSTOMER
}

model PasswordResetOTP {
  id        String   @id @default(uuid()) // Ø´Ù†Ø§Ø³Ù‡ ÛŒÚ©ØªØ§ Ø¨Ø±Ø§ÛŒ ØªÙˆÚ©Ù†
  otp       String //Ø±Ù…Ø² Ø¨Ú©ÛŒØ§Ø± Ù…ØµØ±Ù
  attempts  Int      @default(0) // ØªØ¹Ø¯Ø§Ø¯ Ø¯ÙØ¹Ø§Øª ÙˆØ±ÙˆØ¯ Ø§Ø´ØªØ¨Ø§Ù‡
  expiresAt DateTime // Ø²Ù…Ø§Ù† Ø§Ù†Ù‚Ø¶Ø§ÛŒ ØªÙˆÚ©Ù†
  createdAt DateTime @default(now()) // Ø²Ù…Ø§Ù† Ø§ÛŒØ¬Ø§Ø¯

  user   Users  @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String // Ø¢ÛŒØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± Ù…Ø±ØªØ¨Ø·
}

enum OrderStatus {
  PENDING // Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø±Ø³ÛŒ Ø§Ù¾Ø±Ø§ØªÙˆØ±
  WAITING_PAYMENT // Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ù¾Ø±Ø¯Ø§Ø®Øª ØªÙˆØ³Ø· Ú©Ø§Ø±Ø¨Ø±
  PAID // Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡
  APPROVED // ØªØ§ÛŒÛŒØ¯ Ù†Ù‡Ø§ÛŒÛŒ Ø§Ù¾Ø±Ø§ØªÙˆØ±
  REJECTED // Ø±Ø¯ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ø§Ù¾Ø±Ø§ØªÙˆØ±
  CANCELED // Ù„ØºÙˆ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ú©Ø§Ø±Ø¨Ø±
  COMPLETED // ØªØ³ÙˆÛŒÙ‡ Ùˆ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡
  WAITING_REVIEW // ğŸ‘ˆ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡: Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø±Ø³ÛŒ Ø§Ù¾Ø±Ø§ØªÙˆØ±
}

model UserProfile {
  id       String  @id @default(uuid())
  userId   String  @unique
  avatar   String? // Ø¢ÙˆØ§ØªØ§Ø± Ú©Ø§Ø±Ø¨Ø± (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
  address  String? // Ø¢Ø¯Ø±Ø³ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
  bio      String? // Ø¨ÛŒÙˆÚ¯Ø±Ø§ÙÛŒ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
  whatsapp String? // Ø´Ù…Ø§Ø±Ù‡ ÙˆØ§ØªØ³â€ŒØ§Ù¾
  wechat   String? // Ø¢ÛŒØ¯ÛŒ ÙˆÛŒâ€ŒÚ†Øª

  user Users @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model ExchangeOrder {
  id            Int         @id @default(autoincrement())
  userId        String // Ú©Ø¯ Ú©Ø§Ø±Ø¨Ø±
  amount        Float // Ù…Ù‚Ø¯Ø§Ø± ÛŒÙˆØ§Ù†
  finalAmount   Float // Ù…Ø¨Ù„Øº Ù†Ù‡Ø§ÛŒÛŒ ØªÙˆÙ…Ø§Ù†
  bankAccountId String
  isDisputed    Boolean     @default(false) // Ø§Ø¹ØªØ±Ø§Ø¶ Ø¯Ø§Ø±Ù‡ØŸ
  status        OrderStatus @default(PENDING)
  paymentRef    String? // Ø´Ù…Ø§Ø±Ù‡ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  expiredAt     DateTime? // Ø²Ù…Ø§Ù† Ø§Ù†Ù‚Ø¶Ø§ÛŒ Ø³ÙØ§Ø±Ø´ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø¹ØªØ±Ø¶)

  // bankAccount
  bankAccount BankAccount @relation(fields: [bankAccountId], references: [id])
  //user
  user        Users       @relation(fields: [userId], references: [id])
}

model BankAccount {
  id            String  @id @default(uuid())
  userId        String
  bankName      String? // Ù†Ø§Ù… Ø¨Ø§Ù†Ú©
  accountOwner  String // ØµØ§Ø­Ø¨ Ø­Ø³Ø§Ø¨
  accountNumber String? @unique // Ø´Ù…Ø§Ø±Ù‡ Ø­Ø³Ø§Ø¨
  iban          String? @unique // Ø´Ù…Ø§Ø±Ù‡ Ø´Ø¨Ø§
  cardNumber    String? @unique // Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª
  cardImage     String? //ØªØµÙˆÛŒØ± Ú©Ø§Ø±Øª Ø¨Ø§Ù†Ú©ÛŒ

  user Users @relation(fields: [userId], references: [id], onDelete: Cascade)

  ExchangeOrder ExchangeOrder[]
}

model CompanyInfo {
  id        String           @id @default(uuid())
  name      String
  slogan    String?
  logo      String?
  addresses CompanyAddress[]
}

model CompanyAddress {
  id        String      @id @default(uuid())
  companyId String
  company   CompanyInfo @relation(fields: [companyId], references: [id])
  address   String
  phone     String
  country   String
  email     String
  latitude  Float?
  longitude Float?
}

model FAQ {
  id       String @id @default(uuid())
  question String
  answer   String
}



model SliderImage {
  id          String   @id @default(uuid())
  title       String
  imageUrl    String
  description String?
  link        String?
  createdAt   DateTime @default(now())
  isActive    Boolean  @default(true)
}

model ExchangeRate {
  id           String   @id @default(uuid())
  currency     String
  basePrice    Float
  buyPrice     Float
  sellPrice    Float
  profitMargin Float
  createdAt    DateTime @default(now())
}

model UserActionLog {
  id          String   @id @default(uuid()) // Ø´Ù†Ø§Ø³Ù‡ ÛŒÚ©ØªØ§
  userId      String // Ú©Ø¯ Ú©Ø§Ø±Ø¨Ø±
  user        Users    @relation(fields: [userId], references: [id]) // Ø§Ø±ØªØ¨Ø§Ø· ÛŒÚ© Ø¨Ù‡ Ú†Ù†Ø¯ Ø¨Ø§ Ù…Ø¯Ù„ User
  action      String // Ù†ÙˆØ¹ Ø¹Ù…Ù„ÛŒØ§Øª (ÙˆØ±ÙˆØ¯ØŒ Ø³ÙØ§Ø±Ø´ØŒ ØªØºÛŒÛŒØ± Ø±Ù…Ø² Ùˆ ...)
  description String? // ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø¶Ø§ÙÙ‡ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
  date        DateTime @default(now()) // ØªØ§Ø±ÛŒØ® Ùˆ Ø²Ù…Ø§Ù† Ø¹Ù…Ù„ÛŒØ§Øª
}

model ContactMessage {
  id        String   @id @default(cuid())
  name      String
  email     String
  subject   String
  message   String
  createdAt DateTime @default(now())
}

enum SettingGroup {
  GENERAL
  EMAIL
  SECURITY
  // Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø¹Ø¯ÛŒ Ø±Ùˆ Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒ
}

enum SettingKey {
  PROFIT_MARGIN
  ADMIN_EMAIL
  ORDER_DISPUTE_THRESHOLD
  SMTP_HOST
  SMTP_PORT
  SMTP_USER
  SMTP_PASS
  SENDER_EMAIL
  // Ø¨Ù‚ÛŒÙ‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´Ù†
}

model Setting {
  id        Int          @id @default(autoincrement())
  key       SettingKey   @unique
  value     String
  group     SettingGroup
  updatedAt DateTime     @updatedAt
}
